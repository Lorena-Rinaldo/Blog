<!-- extends chama o arquivo -->
{% extends 'base.html' %}
{% block conteudo %}

<!-- O with msg pegará a primeira mensagem do servidor e vai deixar ali, depois perguntará se tem mensagem e a enviará(caso tenha) -->
{% with msg = get_flashed_messages()|first %}
{% if msg %}
<div id="flashPopup" class="flash-message">
    {{ msg }}
</div>

{% endif %}
{% endwith %}

<div class="inicio">
    <div class="col-esquerda">

    </div>

    <div class="col-centro">
        <div class="form-post">
            <!-- Se estiver no modo de edição, concatena a rota com o post.idPost e converte em string -->
            <form action="{{ '/editarpost/' + post.idPost|string if post else 'novopost' }}" method="post">
                <input type="text" name="titulo" placeholder="Título da Postagem"
                    value="{{ post.titulo if post else '' }}" required>
                <textarea name="conteudo" placeholder="Escreva aqui..."
                    required>{{ post.conteudo if post else '' }}</textarea>
                <button type="submit">{{'Salvar' if post else 'Postar'}}</button>
            </form>
        </div>
        <div class="feed">
            <!-- Caso não haja posts -->
            {% if not postagens %}
            <div class="noPost">
                <img src="../static/img/fox.png" alt="">
                <p>Ainda não temos posts, <br>volte mais tarde</p>
            </div>
            {% else %}
            <!-- A linha abaixo repetirá a div post pela quantidade de postagens -->
            {% for post in postagens %}
            <div class="post">
                <div class="post-header">
                    <div class="user">
                        <div class="user_photo">
                            <img src="../static/uploads/{{post.fotoUsuario}}" alt="">
                        </div>
                        <div>
                            <h2>{{ post.user }} disse:</h2>
                            <p> {{ post.dataPost.strftime('%d/%m/%Y') }} </p>
                        </div>
                    </div>

                    <div class="post-button">
                        <div class="opcoes-menu" id="menuOptions-{{post.idPost}}">
                            <a href="/editarpost/{{post.idPost}}">
                                <h3><i class="fa-solid fa-pencil"></i> Editar</h3>
                            </a>
                            <a href="/excluirpost/{{post.idPost}}">
                                <h3><i class="fa-solid fa-trash"></i> Excluir</h3>
                            </a>
                        </div>
                        <h3 class="ellipsis-icon" id="ellipsisIcon-{{post.idPost}}"><i class="fa-solid fa-ellipsis"></i>
                        </h3>
                    </div>
                </div>
                {% set limite_char = 150 %}
                <div class="post-content">
                    <h2>{{ post.titulo }}</h2>

                    {% if post.conteudo | length > limite_char %}
                    {{ post.conteudo | truncate(limite_char, killwords=False, end='') }}
                    <a href="{{ url_for('exibir_post', idPost=post.idPost) }}">...Leia Mais</a>
                    {% else %}
                    {{ post.conteudo }}
                    {% endif %}
                </div>
                <div class="post-interacao">
                    <hr>
                    <div class="content-interacao">
                        <div class="curtidas" onclick="alternarCurtida()">
                            <i id="icone-curtir" class="far fa-heart"></i> Amei
                        </div>
                        <div class="comentarios">
                            <i class="far fa-comment"></i> Comentar
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>

    <div class="col-direita">

    </div>
</div>

{% endblock %}