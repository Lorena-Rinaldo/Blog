{% extends 'base.html' %}

{% block conteudo %}

<!-- Mensagens Flash (Popups) -->
{% with msg = get_flashed_messages()|first %}
{% if msg %}
<div id="flashPopup"
    class="fixed bottom-5 right-5 z-[1000] w-[16em] p-8 text-center bg-cor-fundo text-cor-principal border border-cor-secundaria rounded-[5px] shadow-[0_4px_8px_rgba(0,0,0,0.2)] transition-opacity duration-500 ease-in-out opacity-0 [&.show]:opacity-100">
    {{ msg }}
</div>
{% endif %}
{% endwith %}

<div class="w-full max-w-6xl mx-auto py-10 px-4 animate-fade-in-down">

    <!-- Título da Página -->
    <div class="mb-8 border-b border-cor-borda pb-4">
        <h2 class="text-3xl font-bold text-cor-principal">Meu Perfil</h2>
        <p class="text-cor-texto-secundaria">Gerencie suas informações pessoais e segurança.</p>
    </div>

    <div class="flex flex-col md:flex-row gap-8">

        <!-- COLUNA ESQUERDA: Cartão de Visualização -->
        <div class="w-full md:w-1/3">
            <div
                class="bg-cor-post rounded-xl shadow-sm border border-cor-borda p-6 flex flex-col items-center text-center">
                <div class="relative group">
                    <!-- Foto de Perfil -->
                    <div
                        class="w-32 h-32 rounded-full p-1 border-2 border-dashed border-azul-purpura mb-4 overflow-hidden">
                        <img id="preview-foto" src="../static/uploads/{{foto}}" alt="Foto de {{nomeUsuario}}"
                            class="w-full h-full rounded-full object-cover group-hover:opacity-80 transition-opacity">
                    </div>
                    <!-- Ícone decorativo -->
                    <div
                        class="absolute bottom-4 right-0 bg-cor-secundaria text-white p-2 rounded-full text-xs shadow-lg">
                        <i class="fa-solid fa-camera"></i>
                    </div>
                </div>

                <h2 class="text-xl font-bold text-cor-texto-principal mb-1">{{ nomeUsuario }}</h2>
                <p class="text-sm text-cor-texto-secundaria mb-4">@{{ user }}</p>

                <div class="w-full border-t border-cor-borda pt-4 mt-2">
                    <p class="text-xs text-cor-texto-secundaria">Membro desde 2025</p>
                </div>
            </div>
        </div>

        <!-- COLUNA DIREITA: Formulário de Edição -->
        <div class="w-full md:w-2/3">
            <div class="bg-cor-post rounded-xl shadow-sm border border-cor-borda p-8">
                <h3 class="text-lg font-bold text-cor-principal mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-user-pen text-azul-purpura"></i> Alterar Dados
                </h3>

                <!-- Adicionado enctype para permitir upload de imagem -->
                <form action="/perfil" method="POST" enctype="multipart/form-data" class="space-y-6">

                    <!-- Grid para Inputs -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Nome -->
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-semibold text-cor-texto-principal">Nome Completo</label>
                            <div class="relative">
                                <span
                                    class="absolute inset-y-0 left-0 pl-3 flex items-center text-cor-texto-secundaria">
                                    <i class="fa-regular fa-id-card"></i>
                                </span>
                                <input type="text" name="nome" value="{{nomeUsuario}}" required
                                    class="w-full pl-10 pr-4 py-2.5 bg-cor-fundo border border-cor-borda rounded-lg focus:outline-none focus:border-azul-purpura focus:ring-1 focus:ring-azul-purpura transition-all text-cor-texto-principal placeholder-gray-400">
                            </div>
                        </div>

                        <!-- Usuário (User) -->
                        <div class="flex flex-col gap-2">
                            <label class="text-sm font-semibold text-cor-texto-principal">Nome de Usuário
                                (@)</label>
                            <div class="relative">
                                <span
                                    class="absolute inset-y-0 left-0 pl-3 flex items-center text-cor-texto-secundaria">
                                    <i class="fa-solid fa-at"></i>
                                </span>
                                <input type="text" name="user" value="{{user}}" required
                                    class="w-full pl-10 pr-4 py-2.5 bg-cor-fundo border border-cor-borda rounded-lg focus:outline-none focus:border-azul-purpura focus:ring-1 focus:ring-azul-purpura transition-all text-cor-texto-principal placeholder-gray-400">
                            </div>
                        </div>
                    </div>

                    <!-- Input de Arquivo Customizado -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-semibold text-cor-texto-principal">Alterar Foto de Perfil</label>
                        <label
                            class="flex flex-col items-center justify-center w-full h-32 border-2 border-cor-borda border-dashed rounded-lg cursor-pointer bg-cor-fundo hover:bg-gray-100 hover:border-azul-lavanda transition-all">
                            <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                <i class="fa-solid fa-cloud-arrow-up text-2xl text-cor-texto-secundaria mb-2"></i>
                                <p class="text-sm text-cor-texto-secundaria"><span class="font-semibold">Clique para
                                        enviar</span> ou arraste aqui</p>
                                <p class="text-xs text-gray-400">PNG, JPG ou WEBP</p>
                            </div>
                            <!-- onchange para pré-visualizar imagem via JS -->
                            <input type="file" name="foto" class="hidden" accept=".png, .jpg, .webp"
                                onchange="previewImage(event)">
                        </label>
                    </div>

                    <hr class="border-cor-borda my-6">

                    <!-- Botões de Ação -->
                    <div class="flex flex-col-reverse md:flex-row justify-end items-center gap-4">

                        <!-- Botão Alterar Senha-->
                        <a href="/usuario/novasenha"
                            class="w-full md:w-auto text-center px-6 py-2.5 text-cor-texto-secundaria font-semibold hover:text-cor-principal hover:bg-cor-fundo rounded-lg transition-colors border border-transparent hover:border-cor-borda">
                            Alterar Senha
                        </a>

                        <!-- Botão Salvar -->
                        <button type="submit"
                            class="w-full md:w-auto px-8 py-2.5 bg-cor-secundaria text-white font-bold rounded-lg shadow-md hover:bg-hover-cor-secundaria hover:shadow-lg transform active:scale-95 transition-all duration-300 flex items-center justify-center gap-2">
                            <i class="fa-regular fa-floppy-disk"></i> Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function previewImage(event) {
        const input = event.target;
        const preview = document.getElementById('preview-foto');

        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                preview.src = e.target.result;
            }

            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

{% endblock %}